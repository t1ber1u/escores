const getCurrentTimeInBucharest = (): number => {
  const currentTime = moment();
  const currentTimezone = moment.tz.guess();
  console.log(`Found Timezone: ${currentTimezone}`);
  console.log(`Found Local Time: ${currentTime.format('HH:mm:ss')}`);

  if (currentTimezone === 'Europe/Bucharest' || currentTimezone === 'Europe/Berlin') {
    const bucharestTime = currentTime.tz('Europe/Bucharest');
    console.log(`Timezone ${currentTimezone} with time in Bucharest: ${bucharestTime.format('HH:mm:ss')}`);
    return bucharestTime.valueOf(); // Current time in milliseconds in Bucharest timezone
  } else {
    const bucharestTimePlus60seconds = currentTime.add(60, 'seconds');
    console.log(`Adding 60 seconds as this environment has been identified as CI and needs to sync the time for valid TAN number`);
    console.log(`Setting Timezone with time in Bucharest plus 60 seconds: ${bucharestTimePlus60seconds.format('HH:mm:ss')}`);
    return bucharestTimePlus60seconds.valueOf(); // Current time in milliseconds in Bucharest timezone
  }
};

const generateTOTP = (secret: string, period: number, timeZone: any) => {
  return TOTP.generate(secret, { algorithm: 'SHA-1', timestamp: getCurrentTimeInBucharest(), period: period });
};