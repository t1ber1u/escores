import { Given, Then, After } from '@wdio/cucumber-framework';
import { expect } from '@wdio/globals';
import openUrl from '../support/action/openUrl';
import DashboardPage from '../pages/dashboard.page';
import { browser } from 'webdriverio';
import { addAttachment } from '@wdio/cucumberjs-json-reporter';

After(async function (scenario) {
    if (scenario.result.status === 'failed') {
        // Take screenshot
        const screenshot = await browser.takeScreenshot();
        
        // Attach screenshot to the JSON report
        addAttachment('Screenshot', Buffer.from(screenshot, 'base64'), 'image/png');
    }
});

Given(/^I am on the main page$/, async () => {
    await openUrl('url', 'https://devi.eden-dev1.cloud.c3.cgn.ag/eden-fe/');
});

Then(/^I should see a page with (.+)$/, async (title) => {
    const pageTitle = await DashboardPage.getTitle();

    try {
        await expect(pageTitle).toBe(title);
    } catch (error) {
        throw new Error(`Expected page title to be ${title}, but found ${pageTitle}`);
    }
});